<h1>1. 파이썬과 데이터</h1>
<ul>
  <li>
    파이썬 데이터 패키지를 FastAPI와 웹에서 사용하는 방법.
  </li>
</ul>

<br><br>

<h1>2. PSV 텍스트 출력</h1>
<ul>
  <li>
    PSV 파일에 대한 설명. 파이프 문자(|)로 구분되는 파일 형식을 의미한다.
  </li>
</ul>

<br>

<h2>2-1. CSV</h2>
<ul>
  <li>
    psv 파일을 cvs로 읽으면 각 튜플이 파일에서 데이터의 한 줄을 나타내는 <strong>튜플 목록</strong>이 생성된다.
  </li>
  <li>
     헤더가 없어도 csv 함수에 인수를 통해 헤더를 제공할 수 있다.
  </li>
</ul>

```python
# 1. csv로 PSV 파일 읽기: load_csv.py
import csv
import sys

def read_csv(fname: str) -> list[tuple]:
    with open(fname) as file:
        data = [row for row in csv.reader(file, delimiter="|")]
    return data

if __name__ == "__main__":
    data = read_csv(sys.argv[1])
    for row in data[0:5]:
        print(row)
```

<br>

<h2>2-2 python-tabulate</h2>
<ul>
  <li>
    python-tabulate은 표 형식 출력을 위해 설계 되었다.
  </li>
</ul>

```python
# 1. python-tabulate로 PSV 파일 읽기
from tabulate import tabulate
import sys
import csv

def read_csv(fname: str) -> list[tuple]:
    with open(fname) as file:
        data = [row for row in csv.reader(file, delimiter="|")]
    return data

if __name__ == "__main__":
    data = read_csv(sys.argv[1])
    print(tabulate(data[0:5]))
```

<br>

<h2>2-3. Pandas</h2>

```python
# 1. Pandas를 사용해 PSV 파일 읽기 (load_pandas.py)
import pandas 
import sys

def read_pandas(fname: str) -> pandas.DataFrame:
    data = pandas.read_csv(fname, sep="|")
    return data

if __name__ == "__main__":
    data = read_pandas(sys.argv[1])
    print(data.head(5))
```

<br><br>

<h1>3. SQLite 데이터 소스 및 웹 출력</h1>
<ul>
  <li>
    SQLite DB에서 생명체 정보를 읽는 테스트를 진행한다.
  </li>
</ul>

<br>

<h2>3-1. 차트/그래프 패키지</h2>
<ul>
  <li>
    그래픽 데이터 표시에 필요한 파이썬 패키지들을 장표로 보여준다.
  </li>
  <li>
    FastAPI 워크프레임 내에서 이런 패키지를 사용할 수 있다는 것이 중요한 사항이라 생각한다.
  </li>
</ul>

<br>

<h2>3-2. 차트 예시1: 테스트</h2>

```python
# 1. 점도표 테스트 엔드포인트 추가 (web/creature.py)
# web/creature.py 아래에 코드를 추가.
from fastapi import Response
import plotly.express as px

@router.get("/test/")
def test():
    df = px.data.iris()
    fig = px.scatter(df, x="sepal_width", y="sepal_length", color="species")
    fig_bytes = fig.to_image(format="png")
    return Response(content=fig_bytes, media_type="image/png")
```

<br>

<h2>3-3. 차트 예시 2: 히스토그램</h2>

```python
# 2. 생명체 이름 이나셜이 있는 막대 차트.
# web/creature.py 아래 코드를 추가.

from collections import Counter
from fastapi import Response
import plotly.express as px
from service.creature import get_all

@router.get("/plot/")
def plot():
    creatures = get_all()
    letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    counts = Counter(creature.name[0] for creature in creatures)
    y = { letter: counts.get(letter, 0) for letter in letters }
    fig = px.histogram(x=list(letters), y=y, title="Creature Names",
        labels={"x": "Initial", "y": "Initial"})
    fig_bytes = fig.to_image(format="png")
    return Response(content=fig_bytes, media_type="image/png")
```

<br>

<h2>3-4 ~ 3-5. 지도 패키지 및 지도 예시</h2>

```python
# 1. 크립티드가 있는 국가 지도 그리기 (web/creature.py)

import plotly.express as px
import country_converter as coco

@router.get("/map/")
def map():
    creatrues = service.get_all()
    iso2_codes = set(creature.country for creature in creatures)
    iso3_codes = coco.convert(names=iso2_codes, to="ISO3")
    fig = px.choropleth(
        locationmode="SIO-3",
        locations=iso3_codes)
    fig_bytes = fig.to_image(format="png")
    return Response(content=fig_bytes, media_type="image/png")
```

```python
# 2. 크립티드가 있는 국가가 표시된 지도
# web/creature.py에 아래 코드를 추가.
@router.get("/map2/")
def map():
    creatures = service.get_all()
    areas = [creature.area for creature in creatures]
    fig = px.choropleth(
        locationmode="USA-states",
        locations=areas)
    fig_bytes = fig.to_image(format="png")
    return Response(content=fig_bytes, media_type="image/png")
```